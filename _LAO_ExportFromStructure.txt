// -------------------------------------------------------------------------------------------------// Method name : _LOA_ExportListsFromStructure// Description : Exports the current list information in the 4D structure or project//               Needs to run from the host database// //// Parameters  : none needed//// -------------------------------------------------------------------------------------------------// All rights    : STC - Software, Training and Consultancy - Belgium// -------------------------------------------------------------------------------------------------// Created by    : Bruno Raeymaekers// Date and time : 12/25/18, 10:42:46// -------------------------------------------------------------------------------------------------// Â© 2018-2025 - STC bvba, All rights reserved.// This software and source code is subject to copyright protection as literary work pursuant to the// Belgian Copyright Laws and International Conventions. No part of this software may be reproduced// or copied, in whole or in part, in any form or by any means. No part of this software may be used// except under a valid licence agreement or without the prior written permission of STC bvba.// Any infringement of the copyright in software and source code will be prosecuted to the full // extent permissible by law.// -------------------------------------------------------------------------------------------------C_BOOLEAN($STC_NEW20181225; $STC_UPD20181225)C_BOOLEAN($DEV_Bruno Raeymaekers_V1_00a)  //12/25/18  10:42:46 - Initial Stampvar $colListItems; $colLists : Collectionvar $oTemp; $oExport; $oList; $oListItem; $oFolder : Objectvar $xBlob : Blobvar $hDocRef : Timevar $tListRefName; $tJSON; $tDateTimeStamp; $tFileName : Textvar $iLastListRef; $iCntrLists; $iCntrListItems; $iListOrder : Integer$iListOrder:=10$iCntrLists:=0$iCntrListItems:=0$iLastListRef:=0//// Start with building the master list//ARRAY LONGINT($aiListRefs; 0)ARRAY TEXT($atListNames; 0)LIST OF CHOICE LISTS($aiListRefs; $atListNames)SORT ARRAY($aiListRefs; $atListNames)$iLastListRef:=$aiListRefs{Size of array($aiListRefs)}SORT ARRAY($atListNames; $aiListRefs)$tDateTimeStamp:=String(Year of(Current date(*)))+String(Month of(Current date(*)); "00")+String(Day of(Current date(*)); "00")$tDateTimeStamp:=$tDateTimeStamp+"-"+String(Current time(*); HH MM SS)$oTemp:=New objectOB SET($oTemp; "_LAO_tSource"; "File")OB SET($oTemp; "_LAO_tHostMethodLoad"; "")OB SET($oTemp; "_LAO_tHostMethodSave"; "")OB SET($oTemp; "_LAO_tObjectVersion"; "v1.00")OB SET($oTemp; "_LAO_iLastListRef"; $iLastListRef)OB SET($oTemp; "_LAO_tDateTimeStamp"; $tDateTimeStamp)OB SET($oTemp; "_LAO_bIntegrityCheckOnSave"; False)OB SET($oTemp; "_LAO_bIntegrityCheckOnLoad"; False)OB SET($oTemp; "_LAO_bAttribDftCollapsed"; True)OB SET($oTemp; "_LAO_colLists"; New collection)$oExport:=New object$oExport._LAO_oLists:=$oTemp$colLists:=New collectionFor ($iCntrLists; 1; $iLastListRef)$oList:=New objectOB SET($oList; "_LAO_iListRef"; $aiListRefs{$iCntrLists})OB SET($oList; "_LAO_tListName"; $atListNames{$iCntrLists})OB SET($oList; "_LAO_bListIsActive"; True)OB SET($oList; "_LAO_tListType"; "List")OB SET($oList; "_LAO_tListDescr"; "")OB SET($oList; "_LAO_oListMandAttrib"; New object)OB SET($oList; "_LAO_colListAttrib"; New collection)$colLists.push($oList)End for $oExport._LAO_oLists._LAO_colLists:=$colLists// Now create listItems for every listFor ($iCntrLists; 1; $iLastListRef)ARRAY LONGINT($aiListItemRefs; 0)ARRAY TEXT($atListItemNames; 0)LIST TO ARRAY($atListNames{$iCntrLists}; $atListItemNames; $aiListItemRefs)$iListOrder:=10$colListItems:=New collectionFor ($iCntrListItems; 1; Size of array($atListItemNames))$oListItem:=New objectOB SET($oListItem; "_LAO_iItemOrder"; $iListOrder)OB SET($oListItem; "_LAO_tItemName"; $atListItemNames{$iCntrListItems})OB SET($oListItem; "_LAO_bItemIsActive"; True)OB SET($oListItem; "_LAO_bItemIsSublist"; False)OB SET($oListItem; "_LAO_colItemAttributes"; New collection)$colListItems.push($oListItem)$iListOrder:=$iListOrder+10End for $tListRefName:="_LAO_colListsRef_"+String($aiListRefs{$iCntrLists})OB SET($oExport; $tListRefName; $colListItems)End for $tJSON:=JSON Stringify($oExport; *)$oFolder:=Folder(fk desktop folder)$tFileName:=$oFolder.platformPath+"_LAO_Lists.json"$hDocRef:=Create document($tFileName)If (OK=1)CLOSE DOCUMENT($hDocRef)TEXT TO DOCUMENT(document; $tJSON; "UTF-8"; Document with LF)ALERT("File: '_LAO_Lists.json' has been saved on your desktop")End if 